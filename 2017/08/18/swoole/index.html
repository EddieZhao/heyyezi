<!DOCTYPE html>
<html lang="zh">
    <head>
    <!--
        © Material Theme
        https://github.com/viosey/hexo-theme-material
        Version: 1.3.4 -->

    <!-- Title -->
    
    <title>
        
            Swoole | 
        
        黑白之院
    </title>

    <!-- Meta & Info -->
    <meta charset="utf-8">

    <!-- dns prefetch -->
    <meta http-equiv="x-dns-prefetch-control" content="on">
    
    
    
        <link rel="dns-prefetch" href="https://changyan.sohu.com"/>
    
    
    
    
        <link rel="dns-prefetch" href="https://busuanzi.ibruce.info"/>
    

    <meta http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#0097A7">
    <meta name="author" content="A Man Has No Name">
    <meta name="description" content="Valar Morghulis">
    <meta name="keywords" content="null,PHP">

    <!-- Favicons -->
    <link rel="icon shortcut" type="image/ico" href="/img/favicon.png">
    <link rel="icon" sizes="192x192" href="/img/favicon.png">
    <link rel="apple-touch-icon" href="/img/favicon.png">

    <!--iOS -->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-title" content="Title">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="480">

    <!-- Add to homescreen for Chrome on Android -->
    <meta name="mobile-web-app-capable" content="yes">

    <!-- Add to homescreen for Safari on iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="黑白之院">

    <!-- The Open Graph protocol -->
    <meta property="og:url" content="https://www.heyyezi.com">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="Swoole | 黑白之院">
    <meta property="og:description" content="Valar Morghulis">
    <meta property="og:article:tag" content="PHP"> 

    <!--[if lte IE 9]>
        <link rel="stylesheet" href="/css/ie-blocker.css">

        
            <script src="/js/ie-blocker.zhCN.js"></script>
        
    <![endif]-->

    <!-- Import CSS & jQuery -->
    
        <link rel="stylesheet" href="/css/material.min.css">
        <link rel="stylesheet" href="/css/style.min.css">
        <!-- Config CSS -->


<!-- Other Styles -->
<style>
  body, html {
    font-family: Roboto, "Helvetica Neue", Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "微软雅黑", Arial, sans-serif;
  }

  a {
    color: #00838F;
  }

  .mdl-card__media,
  #search-label,
  #search-form-label:after,
  #scheme-Paradox .hot_tags-count,
  #scheme-Paradox .sidebar_archives-count,
  #scheme-Paradox .sidebar-colored .sidebar-header,
  #scheme-Paradox .sidebar-colored .sidebar-badge{
    background-color: #0097A7 !important;
  }

  /* Sidebar User Drop Down Menu Text Color */
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:hover,
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:focus {
    color: #0097A7 !important;
  }

  #post_entry-right-info,
  .sidebar-colored .sidebar-nav li:hover > a,
  .sidebar-colored .sidebar-nav li:hover > a i,
  .sidebar-colored .sidebar-nav li > a:hover,
  .sidebar-colored .sidebar-nav li > a:hover i,
  .sidebar-colored .sidebar-nav li > a:focus i,
  .sidebar-colored .sidebar-nav > .open > a,
  .sidebar-colored .sidebar-nav > .open > a:hover,
  .sidebar-colored .sidebar-nav > .open > a:focus,
  #ds-reset #ds-ctx .ds-ctx-entry .ds-ctx-head a {
    color: #0097A7 !important;
  }

  .toTop {
    background: #757575 !important;
  }

  .material-layout .material-post>.material-nav,
  .material-layout .material-index>.material-nav,
  .material-nav a {
    color: #757575;
  }

  #scheme-Paradox .MD-burger-layer {
    background-color: #757575;
  }

  #scheme-Paradox #post-toc-trigger-btn {
    color: #757575;
  }

  .post-toc a:hover {
    color: #00838F;
    text-decoration: underline;
  }

</style>


<!-- Theme Background Related-->

    <style>
      body{
        background-color: #F5F5F5;
      }

      /* blog_info bottom background */
      #scheme-Paradox .material-layout .something-else .mdl-card__supporting-text{
        background-color: #fff;
      }
    </style>




<!-- Fade Effect -->

    <style>
      .fade {
        transition: all 800ms linear;
        -webkit-transform: translate3d(0,0,0);
        -moz-transform: translate3d(0,0,0);
        -ms-transform: translate3d(0,0,0);
        -o-transform: translate3d(0,0,0);
        transform: translate3d(0,0,0);
        opacity: 1;
      }

      .fade.out{
        opacity: 0;
      }
    </style>


        <script src="/js/jquery.min.js"></script>
        <script src="/js/queue.js"></script>
    

    <!-- UC Browser Compatible -->
    <script>
        var agent = navigator.userAgent.toLowerCase();
        if(agent.indexOf('ucbrowser')>0) {
            document.write("<link rel=\"stylesheet\" href=\"/css/uc.css\">");
            alert('由于 UC 浏览器使用极旧的内核，而本网站使用了一些新的特性。\n为了您能更好的浏览，推荐使用 Chrome 或 Firefox 浏览器。');
        }
    </script>

    

    


    <!-- Bing Background -->
    

    <!-- Custom Head -->
    
</head>


    
        <body id="scheme-Paradox" class="lazy">
            <div class="material-layout  mdl-js-layout has-drawer is-upgraded">
                

                <!-- Main Container -->
                <main class="material-layout__content" id="main">

                    <!-- Top Anchor -->
                    <div id="top"></div>

                    
                        <!-- Hamburger Button -->
                        <button class="MD-burger-icon sidebar-toggle">
                            <span class="MD-burger-layer"></span>
                        </button>
                    

                    <!-- Post TOC -->

    
    <!-- Back Button -->
    <!--
    <div class="material-back" id="backhome-div" tabindex="0">
        <a class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon"
           href="#" onclick="window.history.back();return false;"
           target="_self"
           role="button"
           data-upgraded=",MaterialButton,MaterialRipple">
            <i class="material-icons" role="presentation">arrow_back</i>
            <span class="mdl-button__ripple-container">
                <span class="mdl-ripple"></span>
            </span>
        </a>
    </div>
    -->

    <!-- Left aligned menu below button -->
    <button id="post-toc-trigger-btn"
        class="mdl-button mdl-js-button mdl-button--icon">
        <i class="material-icons">format_list_numbered</i>
    </button>

    <ul class="post-toc-wrap mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect" for="post-toc-trigger-btn" style="max-height:80vh; overflow-y:scroll;">
        <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#关于几个概念"><span class="post-toc-number">1.</span> <span class="post-toc-text">关于几个概念</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#关于使用场景"><span class="post-toc-number">2.</span> <span class="post-toc-text">关于使用场景</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#关于namespace的使用"><span class="post-toc-number">3.</span> <span class="post-toc-text">关于namespace的使用</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#多进程模型"><span class="post-toc-number">4.</span> <span class="post-toc-text">多进程模型</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Swoole-Server"><span class="post-toc-number">5.</span> <span class="post-toc-text">Swoole\Server</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Swoole-Worker进程模式"><span class="post-toc-number">6.</span> <span class="post-toc-text">Swoole Worker进程模式</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Reactor线程"><span class="post-toc-number">7.</span> <span class="post-toc-text">Reactor线程</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Worker进程"><span class="post-toc-number">8.</span> <span class="post-toc-text">Worker进程</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Task进程"><span class="post-toc-number">9.</span> <span class="post-toc-text">Task进程</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#关系"><span class="post-toc-number">10.</span> <span class="post-toc-text">关系</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#引申的PHP知识"><span class="post-toc-number">11.</span> <span class="post-toc-text">引申的PHP知识</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#闭包"><span class="post-toc-number">11.1.</span> <span class="post-toc-text">闭包</span></a></li></ol></li></ol>

        <!--
        <li class="mdl-menu__item">
            Some Action
        </li>
        -->
    </ul>




<!-- Layouts -->

    <!-- Post Module -->
    <div class="material-post_container">

        <div class="material-post mdl-grid">
            <div class="mdl-card mdl-shadow--4dp mdl-cell mdl-cell--12-col">

                <!-- Post Header(Thumbnail & Title) -->
                
    <!-- Paradox Post Header -->
    
        
            <!-- Random Thumbnail -->
            <div class="post_thumbnail-random mdl-card__media mdl-color-text--grey-50">
            <script>
    var randomNum = Math.floor(Math.random() * 19 + 1);

    $('.post_thumbnail-random').attr('data-original', '/img/random/material-' + randomNum + '.png');
    $('.post_thumbnail-random').addClass('lazy');
</script>

        
    
            <p class="article-headline-p">
                Swoole
            </p>
        </div>





                
                    <!-- Paradox Post Info -->
                    <div class="mdl-color-text--grey-700 mdl-card__supporting-text meta">

    <!-- Author Avatar -->
    <div id="author-avatar">
        <img src="/img/avatar.png" width="44px" height="44px" alt="Author Avatar"/>
    </div>
    <!-- Author Name & Date -->
    <div>
        <strong>A Man Has No Name</strong>
        <span>8月 18, 2017</span>
    </div>

    <div class="section-spacer"></div>

    <!-- Favorite -->
    <!--
        <button id="article-functions-like-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon btn-like">
            <i class="material-icons" role="presentation">favorite</i>
            <span class="visuallyhidden">favorites</span>
        </button>
    -->

    <!-- Qrcode -->
    
        <button id="article-functions-qrcode-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
            <i class="material-icons" role="presentation">devices other</i>
            <span class="visuallyhidden">devices other</span>
        </button>
        <ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-qrcode-button">
            <li class="mdl-menu__item">在其它设备中阅读本文章</li>
            <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAN4AAADeCAAAAAB3DOFrAAACYklEQVR42u3aMXLDMAwEQP//00mbIrHvQFJWPKvK45EoLgsSAvD4+ujrgYeHh4eHh4eHdzPeI75+GejH/8/vT0Zun/rzXXh4eHiX8F5stfE9xSQC5GxueHh4eFfyZq+cbe7taMUIeHh4eP+Kt7K5J+/Fw8PD+wxeEuw+D6zzZcLDw8O7G2820edJ3iQRfKNcCx4eHl7My5Ow1/++tL6Hh4eHF/DqlqayxNWOs7npCg8PD+8AL9+Io3C23PqTREO7EHh4eHjX8GaNp3lJLA+R27kVXwx4eHh4m3jrxbBZirZd3Dy9i4eHh3eal4Sz7bbeBtArb8fDw8N7Fy8JhesNOjgGkqm3qV48PDy807z11qtZ80ESmuclNDw8PLzreW1RP09JtJNLEhlFSI2Hh4d3gDcrPq2H3W0AvSGNi4eHh7eV1xb41xunZsmIKOWBh4eH9ybe19ZrxtvWU4aHh4d3gDdrFMjTrHkxLD8q6i8GPDw8vE28/JDIf89KXC21LoDh4eHhHeDtahTY2xBQj4+Hh4d3mJcMlCcC8ikm7OE/eHh4eG/i7UoZtOWrpCz34lk8PDy8G/BWjoc8yZuH48OmKzw8PLxjvHY7btMWs0TttoMBDw8Pb5m30j6Vh87J5p4fMy+WGw8PD+8wb9Zc1bYUtM0B7ch4eHh41/NmbQT5RPOlWRkZDw8P73peu0HnT7Xjz44oPDw8vP/CS6a1EkDn88TDw8O7M2+lPWslFRJ9AODh4eFdyEuSEeuJjJz9hlwLHh4e3oEC2N77k2RuHdzj4eHhHeZ93oWHh4eHh4eHh3eD6xuwx0i0N2bX1wAAAABJRU5ErkJggg==">
        </ul>
    

    <!-- Tags (bookmark) -->
    
    <button id="article-functions-viewtags-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
        <i class="material-icons" role="presentation">bookmark</i>
        <span class="visuallyhidden">bookmark</span>
    </button>
    <ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-viewtags-button">
        <li class="mdl-menu__item">
        <a class="post_tag-link" href="/tags/PHP/">PHP</a>
    </ul>
    

    <!-- Share -->
    <button id="article-fuctions-share-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
    <i class="material-icons" role="presentation">share</i>
    <span class="visuallyhidden">share</span>
</button>
<ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-fuctions-share-button">
    

    
        
            <!-- Busuanzi Views -->
            <a class="post_share-link" href="#">
                <li class="mdl-menu__item">
                    <span id="busuanzi_container_page_pv">
                        <span id="busuanzi_value_page_pv"></span>&nbsp;浏览量
                    </span>
                </li>
            </a>
        
    

    <!-- Share Weibo -->
    
        <a class="post_share-link" href="http://service.weibo.com/share/share.php?appkey=&title=Swoole&url=https://www.heyyezi.com//2017/08/18/swoole/index.html&pic=&searchPic=false&style=simple" target="_blank">
            <li class="mdl-menu__item">
                分享到微博
            </li>
        </a>
    

    <!-- Share Twitter -->
    
        <a class="post_share-link" href="https://twitter.com/intent/tweet?text=Swoole&url=https://www.heyyezi.com//2017/08/18/swoole/index.html&via=A Man Has No Name" target="_blank">
            <li class="mdl-menu__item">
                分享到 Twitter
            </li>
        </a>
    

    <!-- Share Facebook -->
    
        <a class="post_share-link" href="https://www.facebook.com/sharer/sharer.php?u=https://www.heyyezi.com//2017/08/18/swoole/index.html" target="_blank">
            <li class="mdl-menu__item">
                分享到 Facebook
            </li>
        </a>
    

    <!-- Share Google+ -->
    
        <a class="post_share-link" href="https://plus.google.com/share?url=https://www.heyyezi.com//2017/08/18/swoole/index.html" target="_blank">
            <li class="mdl-menu__item">
                分享到 Google+
            </li>
        </a>
    

    <!-- Share LinkedIn -->
    

    <!-- Share QQ -->
    

    <!-- Share Telegram -->
    
</ul>

</div>

                

                <!-- Post Content -->
                <div id="post-content" class="mdl-color-text--grey-700 mdl-card__supporting-text fade out">
    
        <blockquote>
<p>关于PHP处理多进程的一个模块</p>
</blockquote>
<h2 id="关于几个概念"><a href="#关于几个概念" class="headerlink" title="关于几个概念"></a>关于几个概念</h2><ol>
<li>进程: 是正在运行的程序的实例。</li>
<li>线程: 调度进程的资源的东西，几乎不占有资源。</li>
</ol>
<h2 id="关于使用场景"><a href="#关于使用场景" class="headerlink" title="关于使用场景"></a>关于使用场景</h2><ol>
<li>希望解决，GM并发大量的发送操作</li>
<li>希望解决，定时执行</li>
<li>提供PHP的多进程解决方案。</li>
</ol>
<p>思考点:<br>关于分布式部署，提供高可用支持。</p>
<h2 id="关于namespace的使用"><a href="#关于namespace的使用" class="headerlink" title="关于namespace的使用"></a>关于namespace的使用</h2><table>
<thead>
<tr>
<th>namespace</th>
<th>函数名</th>
</tr>
</thead>
<tbody>
<tr>
<td>Swoole\Server</td>
<td>swoole_server</td>
</tr>
<tr>
<td>Swoole\Client</td>
<td>swoole_client</td>
</tr>
<tr>
<td>Swoole\Process</td>
<td>swoole_process</td>
</tr>
<tr>
<td>Swoole\Timer</td>
<td>swoole_timer</td>
</tr>
<tr>
<td>Swoole\Table</td>
<td>swoole_table</td>
</tr>
<tr>
<td>Swoole\Lock</td>
<td>swoole_lock</td>
</tr>
<tr>
<td>Swoole\Atomic</td>
<td>swoole_atomic</td>
</tr>
<tr>
<td>Swoole\Buffer</td>
<td>swoole_buffer</td>
</tr>
<tr>
<td>Swoole\Redis</td>
<td>swoole_redis</td>
</tr>
<tr>
<td>Swoole\Event</td>
<td>swoole_event</td>
</tr>
<tr>
<td>Swoole\MySQL</td>
<td>swoole_mysql</td>
</tr>
<tr>
<td>Swoole\Channel</td>
<td>swoole_channel</td>
</tr>
<tr>
<td>Swoole\Http\Server</td>
<td>swoole_http_server</td>
</tr>
<tr>
<td>Swoole\Http\Client</td>
<td>swoole_http_client</td>
</tr>
<tr>
<td>Swoole\Http\Request</td>
<td>swoole_http_request</td>
</tr>
<tr>
<td>Swoole\Http\Response</td>
<td>swoole_http_response</td>
</tr>
<tr>
<td>Swoole\WebSocket\Server</td>
<td>swoole_websocket_server</td>
</tr>
</tbody>
</table>
<h2 id="多进程模型"><a href="#多进程模型" class="headerlink" title="多进程模型"></a>多进程模型</h2><p><img src="https://wiki.swoole.com/static/uploads/swoole.jpg" alt=""></p>
<p>进程和线程模式</p>
<p><img src="https://wiki.swoole.com/static/image/process.jpg" alt=""></p>
<h2 id="Swoole-Server"><a href="#Swoole-Server" class="headerlink" title="Swoole\Server"></a>Swoole\Server</h2><p>配置参数:</p>
<ul>
<li>max_conn, 此参数设置Server最大允许维持的tcp连接数，超过这个限制，服务器会拒绝（不要设置的过大）</li>
<li>max_request, 表示worker进程做多接受多少个请求，如果超过这个数值，manager进程负责回收，并且新建一个worker进程。<ul>
<li>0 表示永远不重启(不建议)</li>
</ul>
</li>
<li>worker_num， worker进程数</li>
<li>task_worker_num， task进程数</li>
<li>daemonize，是否启用后台处理</li>
<li><p>dispatch_mode, 1平均分配，2按FD取模固定分配，3抢占式分配，默认为取模(dispatch=2)</p>
</li>
<li><p>log_file</p>
</li>
</ul>
<h2 id="Swoole-Worker进程模式"><a href="#Swoole-Worker进程模式" class="headerlink" title="Swoole Worker进程模式"></a>Swoole Worker进程模式</h2><ol>
<li>dispatch_mode = 1: 轮询方式处理</li>
<li>dispatch_mode = 1(默认): 数据包根据<code>fd</code> 的值%worker_num来分, 这样可以保证每次TCP连接，都会被同一个worker连接。</li>
<li>dispatch_mode = 3: 争抢模式，只有空闲的进程可以获取处理权限。</li>
</ol>
<h2 id="Reactor线程"><a href="#Reactor线程" class="headerlink" title="Reactor线程"></a>Reactor线程</h2><ul>
<li>负责维护客户端机器的TCP连接、处理网络IO、收发数据完全是异步非阻塞的模式</li>
<li>全部为C代码，除Start/Shudown事件回调外，不执行任何PHP代码</li>
<li>将TCP客户端发来的数据缓冲、拼接、拆分成完整的一个请求数据包</li>
<li>Reactor以多线程的方式运行</li>
</ul>
<h2 id="Worker进程"><a href="#Worker进程" class="headerlink" title="Worker进程"></a>Worker进程</h2><ul>
<li>接受由Reactor线程投递的请求数据包，并执行PHP回调函数处理数据</li>
<li>生成响应数据并发给Reactor线程，由Reactor线程发送给TCP客户端</li>
<li>可以是异步非阻塞模式，也可以是同步阻塞模式</li>
<li>Worker以多进程的方式运行</li>
</ul>
<h2 id="Task进程"><a href="#Task进程" class="headerlink" title="Task进程"></a>Task进程</h2><ul>
<li>接受由Worker进程通过swoole_server-&gt;task/taskwait方法投递的任务</li>
<li>处理任务，并将结果数据返回给Worker进程</li>
<li>完全是同步阻塞模式</li>
<li>Task以多进程的方式运行</li>
</ul>
<h2 id="关系"><a href="#关系" class="headerlink" title="关系"></a>关系</h2><ul>
<li><p>可以理解为reactor就是nginx，worker就是php-fpm。reactor线程异步并行地处理网络请求，然后再转发给worker进程中去处理。reactor和worker间通过IPC方式通信。</p>
</li>
<li><p>swoole的reactor，worker，task_worker之间可以紧密的结合起来，提供更高级的使用方式。</p>
</li>
<li><p>一个更通俗的比喻，假设Server就是一个工厂，那reactor就是销售，帮你接项目订单。而worker就是工人，当销售接到订单后，worker去工作生产出客户要的东西。而task_worker可以理解为行政人员，可以帮助worker干些杂事，让worker专心工作。</p>
</li>
<li><p>底层会为Worker进程、Task进程分配一个唯一的ID</p>
</li>
<li>不同的task/worker进程之间可以通过sendMessage接口进行通信</li>
</ul>
<h2 id="引申的PHP知识"><a href="#引申的PHP知识" class="headerlink" title="引申的PHP知识"></a>引申的PHP知识</h2><h3 id="闭包"><a href="#闭包" class="headerlink" title="闭包"></a>闭包</h3><blockquote>
<blockquote>
<p>只是了解一下，别用它（其实你可以写一个类实现）</p>
</blockquote>
</blockquote>
<p>匿名函数<br><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">$func = <span class="function"><span class="keyword">function</span><span class="params">($params)</span></span>&#123;  </div><div class="line"></div><div class="line">    <span class="keyword">echo</span> $params;</div><div class="line">&#125;;</div><div class="line"></div><div class="line">$func(<span class="string">'ok'</span>)</div><div class="line"></div><div class="line"><span class="comment">// 输出</span></div><div class="line"></div><div class="line"><span class="comment">// ok</span></div></pre></td></tr></table></figure></p>
<p>声明变量，返回一个匿名函数，此变量可以被调用。</p>
<p>那么我们就可以实现PHP闭包</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment">// 第一种</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">printStr</span><span class="params">()</span> </span>&#123;</div><div class="line">    $func = <span class="function"><span class="keyword">function</span><span class="params">( $str )</span> </span>&#123;</div><div class="line">        <span class="keyword">echo</span> $str;</div><div class="line">    &#125;</div><div class="line">    $func(<span class="string">'ok'</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line">printStr();</div><div class="line"></div><div class="line"><span class="comment">// 第二种</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">tF</span><span class="params">()</span> </span>&#123;</div><div class="line">    $func = <span class="function"><span class="keyword">function</span><span class="params">( $str )</span> </span>&#123;</div><div class="line">        <span class="keyword">echo</span> $str;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> $func;</div><div class="line">&#125;</div><div class="line">$f = tF();</div><div class="line">$f(<span class="string">'ok'</span>);</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">// 第三种</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">callFunc</span><span class="params">( $func )</span> </span>&#123;</div><div class="line">    $func(<span class="string">'ok'</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line">$func = <span class="function"><span class="keyword">function</span><span class="params">( $str )</span></span>;</div><div class="line"></div><div class="line">callFunc( func );</div></pre></td></tr></table></figure>
<p>闭包可以保存所有代码块上下文的一些变量。PHP在默认情况下，匿名函数不允许调用代码块的上下文变量， 而需要使用<code>use</code>关键字</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">getMoney</span><span class="params">()</span> </span>&#123;</div><div class="line">    $rmb = <span class="number">1</span>;</div><div class="line">    $dollar = <span class="number">6</span>;</div><div class="line">    $func = <span class="function"><span class="keyword">function</span><span class="params">()</span> <span class="title">use</span> <span class="params">( $rmb )</span> </span>&#123;</div><div class="line">        <span class="keyword">echo</span> $rmb;</div><div class="line">        <span class="keyword">echo</span> $dollar;</div><div class="line">    &#125;;</div><div class="line">    $func();</div><div class="line">&#125;</div><div class="line">getMoney();</div><div class="line"><span class="comment">//输出：</span></div><div class="line"><span class="comment">//1</span></div><div class="line"><span class="comment">//报错，找不到dorllar变量</span></div></pre></td></tr></table></figure>
<p>那么问题来了，能不能改变上下文的变量呢（答案是不能，如果我们想改变呢，答案是换一种写法&amp;)</p>

    

    
</div>


                

                <!-- Post Comments -->
                
                    


    <!-- 使用 changyan -->
    <div id="changyan-comment">
        <!--PC和WAP自适应版-->
<div id="SOHUCS" sid="2017/08/18/swoole/"  ></div>
<script type="text/javascript">
(function(){
var appid = 'undefined';
var conf = 'undefined';
var width = window.innerWidth || document.documentElement.clientWidth;
if (width < 960) {
window.document.write('<script id="changyan_mobile_js" charset="utf-8" type="text/javascript" src="https://changyan.sohu.com/upload/mobile/wap-js/changyan_mobile.js?client_id=' + appid + '&conf=' + conf + '"><\/script>'); } else { var loadJs=function(d,a){var c=document.getElementsByTagName("head")[0]||document.head||document.documentElement;var b=document.createElement("script");b.setAttribute("type","text/javascript");b.setAttribute("charset","UTF-8");b.setAttribute("src",d);if(typeof a==="function"){if(window.attachEvent){b.onreadystatechange=function(){var e=b.readyState;if(e==="loaded"||e==="complete"){b.onreadystatechange=null;a()}}}else{b.onload=a}}c.appendChild(b)};loadJs("https://changyan.sohu.com/upload/changyan.js",function(){window.changyan.api.config({appid:appid,conf:conf})}); } })(); </script>

    </div>
    <style>
        #changyan-comment{
            background-color: #eee;
            padding: 2pc;
        }
    </style>






                
            </div>

            <!-- Post Prev & Next Nav -->
            <nav class="material-nav mdl-color-text--grey-50 mdl-cell mdl-cell--12-col">
    <!-- Prev Nav -->
    

    <!-- Section Spacer -->
    <div class="section-spacer"></div>

    <!-- Next Nav -->
    
        <a href="/2017/08/09/gitflow/" id="post_nav-older" class="next-content">
            旧篇
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_forward</i>
            </button>
        </a>
    
</nav>

        </div>
    </div>



                    
                        <!-- Overlay For Active Sidebar -->
<div class="sidebar-overlay"></div>

<!-- Material sidebar -->
<aside id="sidebar" class="sidebar sidebar-colored sidebar-fixed-left" role="navigation">
    <div id="sidebar-main">
        <!-- Sidebar Header -->
        <div class="sidebar-header header-cover" style="background-image: url(/img/sidebar_header.png);">
    <!-- Top bar -->
    <div class="top-bar"></div>

    <!-- Sidebar toggle button -->
    <button type="button" class="sidebar-toggle mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon" style="display: initial;" data-upgraded=",MaterialButton,MaterialRipple">
        <i class="material-icons">clear_all</i>
        <span class="mdl-button__ripple-container">
            <span class="mdl-ripple">
            </span>
        </span>
    </button>

    <!-- Sidebar Avatar -->
    <div class="sidebar-image">
        <img src="/img/avatar.png" alt="A Man Has No Name's avatar">
    </div>

    <!-- Sidebar Email -->
    <a data-toggle="dropdown" class="sidebar-brand" href="#settings-dropdown">
        hi@heyyezi.com
        <b class="caret"></b>
    </a>
</div>


        <!-- Sidebar Navigation  -->
        <ul class="nav sidebar-nav">
    <!-- User dropdown  -->
    <li class="dropdown">
        <ul id="settings-dropdown" class="dropdown-menu">
            
                <li>
                    <a href="/links/" target="_blank" title="一群疯子">
                        
                            <i class="material-icons sidebar-material-icons sidebar-indent-left1pc-element">email</i>
                        
                        一群疯子
                    </a>
                </li>
            
        </ul>
    </li>

    <!-- Homepage -->
    
        <li id="sidebar-first-li">
            <a href="/" target="_self">
                
                    <i class="material-icons sidebar-material-icons">home</i>
                
                主页
            </a>
        </li>
        
    

    <!-- Archives  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">inbox</i>
                
                    归档
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
            <li>
                <a class="sidebar_archives-link" href="/archives/2017/08/">八月 2017<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/07/">七月 2017<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/06/">六月 2017<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/05/">五月 2017<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/04/">四月 2017<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/03/">三月 2017<span class="sidebar_archives-count">3</span></a>
            </ul>
        </li>
        
    

    <!-- Categories  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">chrome_reader_mode</i>
                
                分类
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
                <li>
                <a class="sidebar_archives-link" href="/categories/API/">API<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/GIT/">GIT<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/Git/">Git<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/JS/">JS<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/JavaScript/">JavaScript<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/JavaScript/Tools/">Tools<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/NodeJS/">NodeJS<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/PHP/">PHP<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/categories/coding/">coding<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/categories/coding/NodeJS/">NodeJS<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/categories/coding/Python/">Python<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/随笔/">随笔<span class="sidebar_archives-count">1</span></a>
            </ul>
        </li>
        
            <li class="divider"></li>
        
    

    <!-- Pages  -->
    
        <li>
            <a href="/tags" title="Tags">
                
                    <i class="material-icons sidebar-material-icons">card_giftcard</i>
                
                Tags
            </a>
        </li>
        
    
        <li>
            <a href="/links" title="Links">
                
                    <i class="material-icons sidebar-material-icons">people</i>
                
                Links
            </a>
        </li>
        
    

    <!-- Article Number  -->
    
        <li>
            <a href="/archives">
                文章总数
                <span class="sidebar-badge">13</span>
            </a>
        </li>
        
    
</ul>


        <!-- Sidebar Footer -->
        <!--
I'm glad you use this theme, the development is no so easy, I hope you can keep the copyright, I will thank you so much.
If you still want to delete the copyrights, could you still retain the first one? Which namely "Theme Material"
It will not impact the appearance and can give developers a lot of support :)

很高兴您使用并喜欢该主题，开发不易 十分谢谢与希望您可以保留一下版权声明。
如果您仍然想删除的话 能否只保留第一项呢？即 "Theme Material"
它不会影响美观并可以给开发者很大的支持和动力。 :)
-->

<!-- Sidebar Divider -->

    <div class="sidebar-divider"></div>


<!-- Theme Material -->


<!-- Help & Support -->
<!--

-->

<!-- Feedback -->
<!--

-->

<!-- About Theme -->
<!--

-->

    </div>

    <!-- Sidebar Image -->
    

</aside>

                    

                    
                        <!-- Footer Top Button -->
                        <div class="toTop-wrap">
    <a href="#top" class="toTop">
        <i class="material-icons footer_top-i">expand_less</i>
    </a>
</div>

                    

                    <!--Footer-->
<footer class="mdl-mini-footer" id="bottom">
    
        <!-- Paradox Footer Left Section -->
        <div class="mdl-mini-footer--left-section sns-list">
    <!-- Twitter -->
    
        <a href="https://twitter.com/twitter" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-twitter.svg);">
                <span class="visuallyhidden">Twitter</span>
            </button><!--
     --></a>
    

    <!-- Facebook -->
    
        <a href="https://www.facebook.com/facebook" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-facebook.svg);">
                <span class="visuallyhidden">Facebook</span>
            </button><!--
     --></a>
    

    <!-- Google + -->
    
        <a href="https://www.google.com/" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-gplus.svg);">
                <span class="visuallyhidden">Google Plus</span>
            </button><!--
     --></a>
    

    <!-- Weibo -->
    

    <!-- Instagram -->
    

    <!-- Tumblr -->
    

    <!-- Github -->
    

    <!-- LinkedIn -->
    

    <!-- Zhihu -->
    

    <!-- Bilibili -->
    

    <!-- Telegram -->
    
</div>


        <!--Copyright-->
        <div id="copyright">
            Copyright&nbsp;©&nbsp;
            <script type="text/javascript">
                var fd = new Date();
                document.write(fd.getFullYear());
            </script>
            &nbsp;黑白之院
        </div>

        <!-- Paradox Footer Right Section -->

        <!--
        I am glad you use this theme, the development is no so easy, I hope you can keep the copyright.
        It will not impact the appearance and can give developers a lot of support :)

        很高兴您使用该主题，开发不易，希望您可以保留一下版权声明。
        它不会影响美观并可以给开发者很大的支持。 :)
        -->

        <div class="mdl-mini-footer--right-section">
            <div>
                <div class="footer-develop-div">Powered by <a href="https://hexo.io" target="_blank" class="footer-develop-a">Hexo</a></div>
                <div class="footer-develop-div">Theme - <a href="https://github.com/viosey/hexo-theme-material" target="_blank" class="footer-develop-a">Material</a></div>
            </div>
        </div>
    
</footer>


                    <!-- Import File -->

    <script src="/js/lazyload.min.js"></script>
    <script src="/js/js.min.js"></script>



    <script src="/js/nprogress.js"></script>


<script type="text/javascript">
    NProgress.configure({
        showSpinner: true
    });
    NProgress.start();
    $('#nprogress .bar').css({
        'background': '#29d'
    });
    $('#nprogress .peg').css({
        'box-shadow': '0 0 10px #29d, 0 0 15px #29d'
    });
    $('#nprogress .spinner-icon').css({
        'border-top-color': '#29d',
        'border-left-color': '#29d'
    });
    setTimeout(function() {
        NProgress.done();
        $('.fade').removeClass('out');
    }, 800);
</script>







    <!-- Busuanzi -->
    <script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>




    <!-- 畅言公共 js 代码 start -->
		<script id="cy_cmt_num" src="https://changyan.sohu.com/upload/plugins/plugins.list.count.js?clientId=undefined">
</script>
    <!-- 畅言公共 js 代码 end -->







<!-- Window Load-->
<script>
    $(window).load(function() {
        // Post_Toc parent position fixed
        $('.post-toc-wrap').parent('.mdl-menu__container').css('position', 'fixed');
    });
</script>

<!-- MathJax Load-->

<script>
    <!-- Offer LazyLoad -->
    queue.offer(function(){
        $('.lazy').lazyload({
            effect : 'show'
        });
    });

    <!-- Start Queue -->
    $(document).ready(function(){
        setInterval(function(){
            queue.execNext();
        },200);
    });
</script>

                </main>
            </div>
        </body>
    
</html>
